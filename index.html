<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sanestory</title>
  <style>
    :root {
      --bg-primary: #f5f3f0;
      --bg-secondary: #ffffff;
      --text-primary: #2c1810;
      --accent: #5c3a21;
      --accent-light: #8c6d5f;
      --border: #ddd;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; }
    .container { max-width: 900px; margin: 0 auto; padding: 20px; }
    header { background: var(--accent); color: white; padding: 20px 0; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    nav { display: flex; justify-content: space-between; align-items: center; max-width: 900px; margin: 0 auto; padding: 0 20px; }
    .logo { font-size: 2em; font-weight: bold; }
    .nav-links button { background: var(--accent-light); color: white; border: none; padding: 8px 15px; margin-left: 5px; border-radius: 4px; cursor: pointer; transition: background 0.3s; }
    .nav-links button:hover { background: var(--accent); }
    main { background: var(--bg-secondary); margin: 30px 0; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
    h2 { color: var(--accent); margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid var(--accent-light); }
    form { background: var(--bg-primary); padding: 25px; border-radius: 6px; }
    input, textarea, select { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid var(--border); border-radius: 4px; font-size: 16px; }
    button[type="submit"] { background: var(--accent); color: white; padding: 12px 30px; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; }
    button[type="submit"]:hover { background: var(--accent-light); }
    .section { display: none; }
    .section.active { display: block; }
    .story-card { background: var(--bg-primary); border-left: 5px solid var(--accent-light); padding: 20px; margin: 20px 0; border-radius: 4px; }
    .story-card h3 { color: var(--accent); margin-bottom: 10px; }
    .story-meta { font-size: 0.9em; color: var(--accent-light); margin-bottom: 15px; }
    .auth-form { max-width: 400px; margin: 30px auto; background: var(--bg-secondary); padding: 25px; border-radius: 8px; }
    .error { color: #ff4444; margin-top: 10px; }
    .success { color: #44ff44; margin-top: 10px; }
    footer { text-align: center; padding: 30px; color: var(--accent-light); }
    .rules-box { background: #fff9e6; border-left: 4px solid #ffa500; padding: 20px; margin: 20px 0; }
    
    /* FEEDBACK SYSTEM */
    .feedback-button { background: var(--accent-light); color: white; padding: 8px 20px; border: none; border-radius: 4px; cursor: pointer; margin-top: 15px; }
    .feedback-form { display: none; margin-top: 15px; }
    .feedback-form.active { display: block; }
    .feedback-list { margin-top: 15px; }
    .feedback-item { background: var(--bg-secondary); padding: 10px; margin: 10px 0; border-radius: 4px; border-left: 3px solid var(--accent); }
    .feedback-author { font-weight: bold; color: var(--accent); }
    .link-button { color: var(--accent); text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <nav>
      <div class="logo">Sanestory</div>
      <div class="nav-links">
        <button id="btn-home">Home</button>
        <button id="btn-submit">Submit</button>
        <button id="btn-browse">Browse</button>
        <button id="btn-profile">Profile</button>
        <button id="btn-auth">Sign Up</button>
      </div>
    </nav>
  </header>

  <div class="container">
    <!-- === HOME === -->
    <section id="section-home" class="section active">
      <h2>Welcome to Sanestory</h2>
      <div class="rules-box">
        <h3>How It Works:</h3>
        <ul>
          <li>‚úçÔ∏è Submit your original story</li>
          <li>üí¨ Give feedback on 2 stories for every 1 you submit</li>
          <li>ü§ù Be specific and kind in your critiques</li>
        </ul>
      </div>
    </section>

    <!-- === SUBMIT === -->
    <section id="section-submit" class="section">
      <h2>Submit Your Story</h2>
      <!-- üö® NO EXTERNAL SERVICE NEEDED - Stories save to browser -->
      <form onsubmit="handleStorySubmit(event)">
        <input type="text" id="story-title" placeholder="Story Title" required>
        <select id="story-genre" required>
          <option value="">Select Genre</option>
          <option value="fiction">Fiction</option>
          <option value="mystery">Mystery</option>
          <option value="romance">Romance</option>
          <option value="scifi">Sci-Fi</option>
          <option value="horror">Horror</option>
        </select>
        <textarea id="story-content" placeholder="Your story (100+ words recommended)" rows="10" required></textarea>
        <button type="submit">Submit for Feedback</button>
        <p id="submit-error" class="error"></p>
      </form>
    </section>

    <!-- === BROWSE === -->
    <section id="section-browse" class="section">
      <h2>Community Stories</h2>
      <div id="stories-container"></div>
    </section>

    <!-- === PROFILE === -->
    <section id="section-profile" class="section">
      <h2>Your Profile</h2>
      <div id="profile-content"></div>
    </section>

    <!-- === REGISTER === -->
    <section id="section-register" class="section">
      <h2>Create Account</h2>
      <form class="auth-form" onsubmit="handleRegister(event)">
        <input type="text" id="reg-user" placeholder="Username" required>
        <input type="password" id="reg-pass" placeholder="Password" required>
        <input type="password" id="reg-confirm" placeholder="Confirm Password" required>
        <button type="submit">Sign Up</button>
        <p id="reg-error" class="error"></p>
        <p id="reg-success" class="success"></p>
      </form>
      <p style="text-align: center;">
        Already have an account? 
        <span class="link-button" onclick="showSection('section-login')">Login here</span>
      </p>
    </section>

    <!-- === LOGIN === -->
    <section id="section-login" class="section">
      <h2>Login</h2>
      <form class="auth-form" onsubmit="handleLogin(event)">
        <input type="text" id="login-user" placeholder="Username" required>
        <input type="password" id="login-pass" placeholder="Password" required>
        <button type="submit">Login</button>
        <p id="login-error" class="error"></p>
      </form>
      <p style="text-align: center;">
        New here? 
        <span class="link-button" onclick="showSection('section-register')">Sign up</span>
      </p>
    </section>

    <footer>
      <p>Built for writers | Sanestory ¬© 2025</p>
    </footer>
  </div>

  <script>
    // === CORE NAVIGATION ===
    const buttons = {
      'btn-home': 'section-home',
      'btn-submit': 'section-submit',
      'btn-browse': 'section-browse',
      'btn-profile': 'section-profile',
      'btn-auth': 'section-register'
    };

    Object.entries(buttons).forEach(([btnId, sectionId]) => {
      document.getElementById(btnId).addEventListener('click', () => {
        if (btnId === 'btn-auth' && document.getElementById('btn-auth').textContent === 'Logout') {
          handleLogout();
        } else {
          showSection(sectionId);
        }
      });
    });

    function showSection(id) {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // === AUTH SYSTEM ===
    function handleRegister(event) {
      event.preventDefault();
      const user = document.getElementById('reg-user').value;
      const pass = document.getElementById('reg-pass').value;
      const confirm = document.getElementById('reg-confirm').value;
      
      if (pass !== confirm) {
        document.getElementById('reg-error').textContent = 'Passwords do not match!';
        return;
      }
      
      if (localStorage.getItem('user_' + user)) {
        document.getElementById('reg-error').textContent = 'Username taken!';
        return;
      }
      
      localStorage.setItem('user_' + user, JSON.stringify({ password: pass, joined: new Date().toLocaleDateString() }));
      localStorage.setItem('loggedInUser', user);
      
      alert('Account created! Welcome, ' + user + '!');
      document.getElementById('btn-auth').textContent = 'Logout';
      showSection('section-home');
    }

    function handleLogin(event) {
      event.preventDefault();
      const user = document.getElementById('login-user').value;
      const pass = document.getElementById('login-pass').value;
      const stored = localStorage.getItem('user_' + user);
      
      if (!stored) {
        document.getElementById('login-error').textContent = 'Username not found!';
        return;
      }
      
      const data = JSON.parse(stored);
      if (data.password !== pass) {
        document.getElementById('login-error').textContent = 'Wrong password!';
        return;
      }
      
      localStorage.setItem('loggedInUser', user);
      alert('Welcome back, ' + user + '!');
      document.getElementById('btn-auth').textContent = 'Logout';
      showSection('section-home');
    }

    function handleLogout() {
      localStorage.removeItem('loggedInUser');
      document.getElementById('btn-auth').textContent = 'Sign Up';
      alert('Logged out!');
      showSection('section-home');
    }

    // === STORY SUBMISSION (NO FORMSPREE NEEDED) ===
    function handleStorySubmit(event) {
      event.preventDefault();
      const user = localStorage.getItem('loggedInUser');
      if (!user) {
        document.getElementById('submit-error').textContent = 'Please sign up first!';
        showSection('section-register');
        return;
      }
      
      const story = {
        id: Date.now().toString(),
        title: document.getElementById('story-title').value,
        genre: document.getElementById('story-genre').value,
        content: document.getElementById('story-content').value,
        author: user,
        timestamp: new Date().toLocaleString(),
        feedback: []
      };
      
      const stories = JSON.parse(localStorage.getItem('stories') || '[]');
      stories.unshift(story);
      localStorage.setItem('stories', JSON.stringify(stories));
      
      alert('Story submitted! It will appear in the gallery.');
      document.getElementById('story-title').value = '';
      document.getElementById('story-genre').value = '';
      document.getElementById('story-content').value = '';
      showSection('section-browse');
      displayStories();
    }

    // === DISPLAY STORIES ===
    function displayStories() {
      const container = document.getElementById('stories-container');
      const stories = JSON.parse(localStorage.getItem('stories') || '[]');
      
      if (stories.length === 0) {
        container.innerHTML = '<p><em>No stories yet. Be the first to submit!</em></p>';
        return;
      }
      
      container.innerHTML = stories.map(story => `
        <div class="story-card" data-story-id="${story.id}">
          <h3>${story.title}</h3>
          <div class="story-meta">Genre: ${story.genre} | By: ${story.author} | ${story.timestamp}</div>
          <p>${story.content.substring(0, 200)}${story.content.length > 200 ? '...' : ''}</p>
          
          <!-- FEEDBACK BUTTON -->
          <button class="feedback-button" onclick="toggleFeedback('${story.id}')">Leave Feedback</button>
          
          <div class="feedback-form" id="feedback-${story.id}">
            <h4>Your Feedback:</h4>
            <textarea id="comment-${story.id}" placeholder="What worked well? What could improve?" rows="5"></textarea>
            <button type="button" onclick="submitFeedback('${story.id}')">Post Feedback</button>
          </div>
          
          <div class="feedback-list" id="list-${story.id}"></div>
        </div>
      `).join('');
      
      stories.forEach(story => displayFeedback(story.id));
    }

    // === FEEDBACK SYSTEM ===
    function toggleFeedback(storyId) {
      document.getElementById('feedback-' + storyId).classList.toggle('active');
    }

    function submitFeedback(storyId) {
      const comment = document.getElementById('comment-' + storyId).value;
      if (!comment.trim()) {
        alert('Please write some feedback!');
        return;
      }
      
      const user = localStorage.getItem('loggedInUser') || 'Guest';
      const stories = JSON.parse(localStorage.getItem('stories') || '[]');
      const story = stories.find(s => s.id === storyId);
      
      if (story) {
        story.feedback.push({
          author: user,
          comment: comment,
          timestamp: new Date().toLocaleString()
        });
        localStorage.setItem('stories', JSON.stringify(stories));
      }
      
      document.getElementById('comment-' + storyId).value = '';
      document.getElementById('feedback-' + storyId).classList.remove('active');
      alert('Feedback posted! Thank you!');
      displayFeedback(storyId);
    }

    function displayFeedback(storyId) {
      const stories = JSON.parse(localStorage.getItem('stories') || '[]');
      const story = stories.find(s => s.id === storyId);
      const container = document.getElementById('list-' + storyId);
      
      if (!story || !story.feedback.length) {
        container.innerHTML = '';
        return;
      }
      
      container.innerHTML = '<h4>Feedback:</h4>' + story.feedback.map(f => `
        <div class="feedback-item">
          <span class="feedback-author">${f.author}:</span> ${f.comment}<br><small>${f.timestamp}</small>
        </div>
      `).join('');
    }

    // === PROFILE DISPLAY ===
    function updateProfile() {
      const user = localStorage.getItem('loggedInUser');
      const content = document.getElementById('profile-content');
      
      if (user) {
        const data = JSON.parse(localStorage.getItem('user_' + user) || '{}');
        const stories = JSON.parse(localStorage.getItem('stories') || '[]');
        const myStories = stories.filter(s => s.author === user);
        
        content.innerHTML = `
          <h3>Hello, ${user}!</h3>
          <p><strong>Member since:</strong> ${data.joined || 'Today'}</p>
          <p><strong>Stories submitted:</strong> ${myStories.length}</p>
          <button onclick="handleLogout()">Logout</button>
        `;
      } else {
        content.innerHTML = `<p><span class="link-button" onclick="showSection('section-register')">Create an account</span> to track your activity.</p>`;
      }
    }

    // === INITIALIZE ===
    document.addEventListener('DOMContentLoaded', () => {
      displayStories();
      updateProfile();
    });
  </script>
</body>
</html>
